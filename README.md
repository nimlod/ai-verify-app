# AI Content Verify App (Complete)
SNSの画像・動画がAI生成かを検証し、制作ログのハッシュチェーン＋完成動画の一致で承認・公開照合する、フルスタック実装です。

## 構成
- **client**: Vite + React + TypeScript + Tailwind + shadcn風UI + Supabase認証UI
- **server**: Express + SQLite (better-sqlite3) + ファイルアップロード + セッション/イベントチェーン検証
  - 承認時、**Supabase** の `approved_outputs` テーブルへREST経由で記録
- **authlog**: メール+パスワードのシンプルJWTサーバ（あなたが送ってくれた `logserver.js` を同梱）
  - プロジェクト単位のチェーンログ（GENESIS, append, verify）デモ用API
- **supabase**: サーバ側で使うテーブル定義・メモ

> 注: 本番では server 側も Supabase 認証で統一するのが理想ですが、今回は受領コードを尊重して **server** と **authlog** を併存しています。

## 事前準備 (.env)
プロジェクトルートに `.env` を作り、以下を設定してください（値は supabase のプロジェクトから）:

```
SUPABASE_URL=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_KEY=
SERVER_PORT=3000
AUTHLOG_PORT=4000
JWT_SECRET=dev-secret
```

クライアントの開発時は `client/.env` へ
```
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=
VITE_SERVER_URL=http://localhost:3000
VITE_AUTHLOG_URL=http://localhost:4000
```

## セットアップ
```
# 1) 依存をインストール
cd server && npm i && cd ..
cd authlog && npm i && cd ..
cd client && npm i && cd ..

# 2) サーバ起動（2つ）
cd server && npm run dev
# 別ターミナルで
cd authlog && npm run dev

# 3) フロント起動
cd client && npm run dev
```

- サーバ: http://localhost:3000
- 認証ログAPI: http://localhost:4000
- フロント: http://localhost:5173

## Supabase テーブル: approved_outputs
PostgREST経由で書き込みます。SQL例（Supabase SQLエディタで実行）:
```sql
create table if not exists approved_outputs (
  id bigint generated by default as identity primary key,
  final_hash text unique not null,
  session_id text,
  user_id text,
  project_name text,
  file_url text,
  approved_at timestamp with time zone default now()
);
-- RLS (最低限のサンプル: 読み取りは匿名OK、書き込みはService Keyのみ)
alter table approved_outputs enable row level security;
create policy "read_any" on approved_outputs for select using (true);
```

## 動作確認（例）
- **リアルタイムチェーン**: フロントの「Sessions」タブで start → event → finish を実行。
- **公開照合**: 「Public Check」で完成動画ファイルをアップするか、ハッシュを入力。
- **JWTチェーン（authlog）**: 「JWT Logs」タブでサインアップ→GENESIS→append→verify。

## 重要補足
- ローカル保存DB: `server/registry.db` と `authlog/logs.db` は自動生成。
- アップロード先: `server/uploads`（承認後は `verified/` から静的配信）。
- 本番は Render/Railway/Vercel 等に合わせて `CORS` と `ファイル永続化` を調整してください。
